(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[0],{39:function(t,e,n){"use strict";n.r(e);var c,a,i,r,o=n(0),s=n(19),j=n.n(s),b=n(6),d=n(2),u=n(3),l=n(4),O="token",h=function(t){localStorage.setItem(O,t)},p=function(){return localStorage.getItem(O)},x="https://student-json-api.lidemy.me",f=function(){var t=p();return fetch("".concat(x,"/me"),{headers:{authorization:"Bearer ".concat(t)}}).then((function(t){return t.json()}))},g=n(10),v=n(1),m=u.a.div(c||(c=Object(d.a)(["\n  width: 80%;\n  margin: 0 auto;\n"]))),y=u.a.div(a||(a=Object(d.a)(["\n  border-bottom: 1px solid rgba(0, 12, 34, 0.2);\n  padding: 16px;\n  display: flex;\n  align-items: flex-end;\n  justify-content: space-between;\n"]))),w=Object(u.a)(g.b)(i||(i=Object(d.a)(["\n  font-size: 24px;\n  color: #333;\n  text-decoration: none;\n"]))),S=u.a.div(r||(r=Object(d.a)(["\n  color: rgba(0, 0, 0, 0.3);\n"])));function k(t){var e=t.post;return Object(v.jsxs)(y,{children:[Object(v.jsx)(w,{to:"/posts/".concat(e.id),children:e.title}),Object(v.jsx)(S,{children:new Date(e.createdAt).toLocaleString()})]})}function C(){var t=Object(o.useState)([]),e=Object(b.a)(t,2),n=e[0],c=e[1];return Object(o.useEffect)((function(){fetch("".concat(x,"/posts?_sort=createdAt&_order=desc")).then((function(t){return t.json()})).then((function(t){c(t)}))}),[]),Object(v.jsx)(m,{children:n.map((function(t){return Object(v.jsx)(k,{post:t},t.id)}))})}var z,E,J,$,B,D,I,P=Object(o.createContext)(null),T=u.a.div(z||(z=Object(d.a)(["\n  width: 400px;\n  margin: 10px auto;\n  border: 1px solid black;\n  padding: 10px;\n"]))),U=u.a.div(E||(E=Object(d.a)(["\n  margin-bottom: 10px;\n  input {\n    width: 320px;\n  }\n"]))),A=u.a.div(J||(J=Object(d.a)(["\n  margin-bottom: 10px;\n  input {\n    width: 320px;\n  }\n"]))),N=u.a.div($||($=Object(d.a)(["\n  color: red;\n"])));function _(){var t=Object(o.useContext)(P).setUser,e=Object(o.useState)(""),n=Object(b.a)(e,2),c=n[0],a=n[1],i=Object(o.useState)(""),r=Object(b.a)(i,2),s=r[0],j=r[1],d=Object(o.useState)(),u=Object(b.a)(d,2),O=u[0],p=u[1],g=Object(l.f)();return Object(v.jsx)(T,{children:Object(v.jsxs)("form",{onSubmit:function(e){e.preventDefault(),function(t,e){return fetch("".concat(x,"/login"),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({username:t,password:e})}).then((function(t){return t.json()}))}(c,s).then((function(e){if(0===e.ok)return p(e.message);h(e.token),p(""),f().then((function(e){if(1!==e.ok)return h(null),p(e.toString());t(e.data),g.push("/")}))}))},children:[Object(v.jsxs)(U,{children:["username: ",Object(v.jsx)("input",{type:"text",value:c,onChange:function(t){return a(t.target.value)}})]}),Object(v.jsxs)(A,{children:["password: ",Object(v.jsx)("input",{type:"password",value:s,onChange:function(t){return j(t.target.value)}})]}),Object(v.jsx)("button",{type:"submit",children:"\u767b\u5165"}),O&&Object(v.jsx)(N,{children:O})]})})}var L,q,F,G,H=u.a.div(B||(B=Object(d.a)(["\n    width: 80%;\n    margin: 0 auto;\n  "]))),K=u.a.div(D||(D=Object(d.a)(["\n  text-align: center;\n  font-size: 24px;\n"]))),M=u.a.div(I||(I=Object(d.a)([""])));function Q(){var t=Object(l.h)().slug,e=Object(o.useState)({title:"",body:""}),n=Object(b.a)(e,2),c=n[0],a=n[1];return Object(o.useEffect)((function(){var e;(e=t,fetch("".concat(x,"/posts?id=").concat(e)).then((function(t){return t.json()}))).then((function(t){t.length>0&&a(t[0])}))}),[t]),Object(v.jsxs)(H,{children:[Object(v.jsx)(K,{children:c.title}),Object(v.jsx)(M,{children:c.body})]})}var R,V,W,X,Y,Z=u.a.div(L||(L=Object(d.a)(["\n  width: 80%;\n  margin: 0 auto;\n"]))),tt=u.a.div(q||(q=Object(d.a)(["\n  padding: 5px 0;\n  input {\n    width: 100%;\n  }\n\n  div {\n    padding-bottom: 5px;\n  }\n"]))),et=u.a.div(F||(F=Object(d.a)(["\n  padding-bottom: 10px;\n  \n  textarea {\n    width: 100%;\n  }\n\n  div {\n    padding-bottom: 5px;\n  }\n"]))),nt=u.a.div(G||(G=Object(d.a)(["\n  color: red;\n"])));function ct(){var t=Object(o.useState)(""),e=Object(b.a)(t,2),n=e[0],c=e[1],a=Object(o.useState)(""),i=Object(b.a)(a,2),r=i[0],s=i[1],j=Object(o.useState)(),d=Object(b.a)(j,2),u=d[0],O=d[1],h=Object(l.f)();return Object(v.jsx)(Z,{children:Object(v.jsxs)("form",{onSubmit:function(t){t.preventDefault(),function(t,e){var n=p();return fetch("".concat(x,"/posts"),{method:"POST",headers:{"content-type":"application/json",authorization:"Bearer ".concat(n)},body:JSON.stringify({title:t,body:e})}).then((function(t){return t.json()}))}(n,r).then((function(t){if(console.log(t),0===t.ok)return O(t.message);h.push("/")}))},children:[Object(v.jsxs)(tt,{children:[Object(v.jsx)("div",{children:"Title"}),Object(v.jsx)("input",{type:"text",value:n,onChange:function(t){return c(t.target.value)}})]}),Object(v.jsxs)(et,{children:[Object(v.jsx)("div",{children:"Content"}),Object(v.jsx)("textarea",{rows:"10",value:r,onChange:function(t){return s(t.target.value)}})]}),Object(v.jsx)("div",{children:Object(v.jsx)("button",{type:"submit",children:"\u65b0\u589e"})}),u&&Object(v.jsx)(nt,{children:u})]})})}var at,it=u.a.div(R||(R=Object(d.a)(["\n  height: 64px;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  right: 0;\n  border-bottom: 1px solid rgba(0, 0, 0, 0.2);\n  padding: 0px 32px;\n  background: white;\n"]))),rt=u.a.div(V||(V=Object(d.a)(["\n  display: flex;\n  align-utems: center;\n\n"]))),ot=u.a.div(W||(W=Object(d.a)(["\n  display: flex;\n  align-items: center;\n\n  "," {\n    margin-left: 64px;\n  }\n"])),rt),st=u.a.div(X||(X=Object(d.a)(["\n  font-size: 32px;\n  font-weight: bold;\n"]))),jt=Object(u.a)(g.b)(Y||(Y=Object(d.a)(["\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 64px;\n  box-sizing: border-box;\n  width: 100px;\n  cursor: pointer;\n  color: black;\n  text-decoration: none;\n\n  ","\n"])),(function(t){return t.$active&&"\n      background: rgba(0, 0, 0, 0.1);\n    "}));function bt(t){var e=t.done,n=Object(l.g)(),c=Object(l.f)(),a=Object(o.useContext)(P),i=a.user,r=a.setUser;return console.log(e),Object(v.jsxs)(it,{children:[Object(v.jsxs)(ot,{children:[Object(v.jsx)(st,{children:"\u90e8\u843d\u683c"}),Object(v.jsxs)(rt,{children:[Object(v.jsx)(jt,{to:"/",$active:"/"===n.pathname,children:"\u9996\u9801"}),i&&e&&Object(v.jsx)(jt,{to:"/new-post",$active:"/new-post"===n.pathname,children:"\u767c\u4f48\u6587\u7ae0"})]})]}),Object(v.jsxs)(rt,{children:[!i&&e&&Object(v.jsx)(jt,{to:"/login",$active:"/login"===n.pathname,children:"\u767b\u5165"}),i&&e&&Object(v.jsx)(jt,{to:"#",onClick:function(){h(""),r(null),"/"!==n.pathname&&c.push("/")},children:"\u767b\u51fa"})]})]})}var dt=u.a.div(at||(at=Object(d.a)(["\n  padding-top: 64px;\n"])));function ut(){var t=Object(o.useState)(),e=Object(b.a)(t,2),n=e[0],c=e[1],a=Object(o.useState)(!1),i=Object(b.a)(a,2),r=i[0],s=i[1];return Object(o.useEffect)((function(){p()&&f().then((function(t){1===t.ok&&c(t.data)})),s(!0)}),[]),Object(v.jsx)(P.Provider,{value:{user:n,setUser:c},children:Object(v.jsxs)(dt,{children:[Object(v.jsx)(bt,{done:r}),Object(v.jsxs)(l.c,{children:[Object(v.jsx)(l.a,{exact:!0,path:"/",children:Object(v.jsx)(C,{})}),Object(v.jsx)(l.a,{path:"/posts/:slug",children:Object(v.jsx)(Q,{})}),Object(v.jsx)(l.a,{path:"/new-post",children:Object(v.jsx)(ct,{})}),Object(v.jsx)(l.a,{path:"/login",children:Object(v.jsx)(_,{})})]})]})})}j.a.render(Object(v.jsx)(g.a,{children:Object(v.jsx)(ut,{})}),document.getElementById("root"))}},[[39,1,2]]]);
//# sourceMappingURL=main.65ee96e8.chunk.js.map